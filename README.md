# Laravel Inertia ShareDialog

Adds Share Functionality in your Laravel Projects.

[![Latest Version on Packagist](https://img.shields.io/packagist/v/geekyants/share-dialog.svg?style=flat-square)](https://packagist.org/packages/geekyants/share-dialog)
[![Build Status](https://img.shields.io/travis/geekyants/share-dialog/master.svg?style=flat-square)](https://travis-ci.org/geekyants/share-dialog)
[![Quality Score](https://img.shields.io/scrutinizer/g/geekyants/share-dialog.svg?style=flat-square)](https://scrutinizer-ci.com/g/geekyants/share-dialog)
[![Total Downloads](https://img.shields.io/packagist/dt/geekyants/share-dialog.svg?style=flat-square)](https://packagist.org/packages/geekyants/share-dialog)

![ShareDialog](./public/images/share-dialog.gif)

---

## Introduction

Share-dialog is a composer package for laravel projects which allows other users to read/write your project's entities.

It helps in managing roles and permissions for any app using Eloquent models. You can assign read or write ability to the user with whom you want to share your entity and remove the ability if you want to.

---

## Prerequisites

If you have [Tailwind](https://tailwindcss.com/) and [Bouncer](https://github.com/JosephSilber/bouncer) pre-installed you can move to the [Installation](###installation) section.

### Tailwind

```bash
npm install -D tailwindcss@latest postcss@latest autoprefixer@latest

```

Next, generate your tailwind.config.js file:

```bash
npx tailwindcss init
```

In your tailwind.config file

```bash

  module.exports = {
   purge: [
     './resources/**/*.blade.php',
     './resources/**/*.js',
     './resources/**/*.vue',
   ],
    darkMode: false, // or 'media' or 'class'
    theme: {
      extend: {},
    },
    variants: {
      extend: {},
    },
    plugins: [],
  }
```

### **Bouncer**

Install Bouncer with composer:

```bash
composer require silber/bouncer v1.0.0-rc.10
```

Add Bouncer's trait to your user model:

```bash
use Silber\Bouncer\Database\HasRolesAndAbilities;

class User extends Model
{
    use HasRolesAndAbilities;
}
```

Publish the bouncer's migrations into your app's migrations directory, by running the following command:

```bash
php artisan vendor:publish --tag="bouncer.migrations"
```

---

## **Installation**

Install share-dialog package with composer

```bash
composer require  geekyants/share-dialog
```

After installation, move the package's config file to your project's config folder by executing the following command-

```bash
php artisan vendor:publish  --tag="config"
```

Moving forward, scaffold the view components present in the share-dialog package.

```jsx
php artisan ui share-dialog
```

A **Share-Dialog** folder containing Vuejs components would be created in your resources directory. Now, you can easily customize your share-dialog's Vuejs components. :)

Now, run the migrations. After executing this command, Bouncer migrations and new_users_share_dialog table would be migrated.

```bash
php artisan migrate
```

To compile and minify the CSS and JavaScript files generated by share-dialog, add this to your webpack.mix.js.

```php
.js("resources/js/share-dialog.js", "public/js")
.vue()
```

> Note: Share-dialog depends upon on your css file generated by laravel-mix. By default it assumes that your css is in app.css file.If you have some other file you can change it in share-dialog.blade.php file.

Install the dependenices

```bash
composer update
npm install
```

Finally, build your assets

```bash
npm run dev
```

---

## Usage

> You must define a relation **`user`** on the entity model that you want to share. The relation should return the instance of the user who created it.

To share your entity with other users visit-

`{APP_URL}/share-dialog/{entity_name}/{entity_id}`

For example, if you want to open share dialog for your Project model with id 123

then visit

`{APP_URL}/share-dialog/projects/123`

> Note: The entity_name should have the same name as that of the database migration corresponding to the model that you want to share.

**Share-Dialog sends error messages back to your application in the error props.**

If you invite a user which is not present in your database, share-dialog automatically creates it in your users table. Also, a new entry is inserted into the new_users_share_dialog table referencing the user's id as a foreign key and `has_ever_logged_in property` to false.

This can help you if you want to differentiate between the users created by share-dialog and users created by normal sign-up flow.<br>

> To restrict the other users from accessing your entities you have to explicitly use the Bouncer methods. You can check them out [here](https://github.com/JosephSilber/bouncer#cheat-sheet).

---

## Customization

You can customize the functionality of share-dialog easily by making changes in the **share-dialog.php** file present in your config folder.

1. If your model files are present in some other folder other than `"App\Models\\"` you can set the `modelPath` to the path of that folder.

    ```bash
    "modelPath" => "App\Models\\"
    ```

2. If you want to add your own custom middleware to the share-dialog, append it into the middleware array. For example, if you want to add the `"admin"` middleware then your middleware array would look like this-

    ```php
    "middleware" => ['web', 'auth','admin']
    ```

3. If you want only certain entities to be shareable you can add them into the `restrict-entities` array. For example, if your want only the `files` entity to be shareable-

    ```php
    'restrict-entities' => ['files'],
    ```

4. You can also send email notifications to the users when they are given access to an entity.

    ShareDialog fires an `UserAbilityChanged` event when the user's access gets changed and attaches the `SendUserAbilityChangedNotification` listener to it. If you want to send email notification then in your EventServiceProvider.

    ```php
    use Geekyants\ShareDialog\Events\UserAbilityChanged;
    use Geekyants\ShareDialog\Listeners\SendUserAbilityChangedNotification;
    protected $listen = [
      ...
           UserAbilityChanged::class => [
             SendUserAbilityChangedNotification::class,
         ]

     ];
    ```

    You can also modify the email template by publishing the share-dialog mail resources. After running this command, the mail notification template will be located in the

    `resources/vendor/share-dialog/mail directory.`

    ```php
    php artisan vendor:publish  --tag="mail"
    ```

    You can also attach your own listeners to the event.For example, if you want to to attach `SendSlackNotification` listener to the event then

    ```php
    use Geekyants\ShareDialog\Events\UserAbilityChanged;

    ...

    protected $listen = [
            UserAbilityChanged::class => [
                SendSlackNotification::class,
            ]
        ];
    ```

## License

The MIT License (MIT). Please see [License File](LICENSE.md) for more information.
